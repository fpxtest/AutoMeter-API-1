webpackJsonp([40],{e7ci:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("Dd8w"),n=i.n(a),p=i("W+bg"),s=i("XcM5"),o=i("L6vm"),l=i("0xDb"),r=i("NYxO"),c={filters:{statusFilter:function(t){return{published:"success",draft:"gray",deleted:"danger"}[t]}},data:function(){return{itemKey:null,tmpapiname:"",tmpdeployunitname:"",apiList:[],sourceapiList:[],visittypeList:[],deployunitList:[],requestcontentList:[],responecontenttypeList:[],requestcontenttypeVisible:!1,listLoading:!1,dicvisitypeQuery:{page:1,size:30,diccode:"httpvisittype"},dicrequestypeQuery:{page:1,size:30,diccode:"requestcontentype"},dicresponetypeQuery:{page:1,size:30,diccode:"responecontenttype"},total:0,listQuery:{page:1,size:20,listLoading:!0,apiname:"",deployunitname:""},dialogStatus:"add",CopyApi:"复制API",CopydialogFormVisible:!1,dialogFormVisible:!1,textMap:{updateRole:"修改api",update:"修改api",add:"添加api"},btnLoading:!1,tmpapi:{id:"",deployunitid:"",deployunitname:"",apiname:"",visittype:"",apistyle:"",path:"",requestcontenttype:"",responecontenttype:"",memo:"",creator:""},tmpcopyapi:{sourceapiid:"",sourceapiname:"",sourcedeployunitid:"",sourcedeployunitname:"",objectdeployunitid:"",objectdeployunitname:"",newapiname:""},search:{page:1,size:10,apiname:null,deployunitname:null}}},computed:n()({},Object(r.b)(["name","sidebar","avatar"])),created:function(){this.getapiList(),this.getvisittypeList(),this.getrequestcontenttypeList(),this.getresponecontenttypeList(),this.getdepunitLists()},methods:{unix2CurrentTime:l.b,selectChanged:function(t){for(var e=0;e<this.deployunitList.length;e++)this.deployunitList[e].deployunitname===t&&(this.tmpapi.deployunitid=this.deployunitList[e].id),console.log(this.deployunitList[e].id)},CopyAPISourceDeployselectChanged:function(t){for(var e=this,i=0;i<this.deployunitList.length;i++)this.deployunitList[i].deployunitname===t&&(this.tmpcopyapi.sourcedeployunitid=this.deployunitList[i].id);Object(p.e)(this.tmpcopyapi).then(function(t){e.sourceapiList=t.data}).catch(function(t){e.$message.error("根据发布单元id获取api列表失败")})},CopySourceAPIChanged:function(t){for(var e=0;e<this.sourceapiList.length;e++)this.sourceapiList[e].apiname===t&&(this.tmpcopyapi.sourceapiid=this.sourceapiList[e].id)},CopyObjectAPIDeployUnitChanged:function(t){for(var e=0;e<this.deployunitList.length;e++)this.deployunitList[e].deployunitname===t&&(this.tmpcopyapi.objectdeployunitid=this.deployunitList[e].id)},copyapi:function(){var t=this;this.$refs.tmpcopyapi.validate(function(e){e&&(t.btnLoading=!0,Object(p.b)(t.tmpcopyapi).then(function(){t.$message.success("复制成功"),t.getapiList(),t.CopydialogFormVisible=!1,t.btnLoading=!1}).catch(function(e){t.$message.error("复制失败"),t.btnLoading=!1}))})},visitypeselectChanged:function(t){"get"===t?(this.requestcontenttypeVisible=!1,this.tmpapi.requestcontenttype=""):this.requestcontenttypeVisible=!0},getapiList:function(){var t=this;this.listLoading=!0,this.search.apiname=this.tmpapiname,this.search.deployunitname=this.tmpdeployunitname,Object(p.h)(this.search).then(function(e){t.apiList=e.data.list,t.total=e.data.total,t.listLoading=!1}).catch(function(e){t.$message.error("加载api列表失败")})},getvisittypeList:function(){var t=this;Object(o.c)(this.dicvisitypeQuery).then(function(e){t.visittypeList=e.data.list}).catch(function(e){t.$message.error("加载字典访问方式列表失败")})},getrequestcontenttypeList:function(){var t=this;Object(o.c)(this.dicrequestypeQuery).then(function(e){t.requestcontentList=e.data.list}).catch(function(e){t.$message.error("加载请求数据格式列表失败")})},getresponecontenttypeList:function(){var t=this;Object(o.c)(this.dicresponetypeQuery).then(function(e){t.responecontenttypeList=e.data.list}).catch(function(e){t.$message.error("加载响应数据格式列表失败")})},getdepunitLists:function(){var t=this;this.listLoading=!0,Object(s.e)().then(function(e){t.deployunitList=e.data,t.total=e.data.total,t.listLoading=!1}).catch(function(e){t.$message.error("加载发布单元列表失败")})},searchBy:function(){var t=this;this.search.page=1,this.listLoading=!0,Object(p.h)(this.search).then(function(e){t.itemKey=Math.random(),t.apiList=e.data.list,t.total=e.data.total}).catch(function(e){t.$message.error("搜索失败")}),this.listLoading=!1,this.btnLoading=!1,this.tmpapiname=this.search.apiname,this.tmpdeployunitname=this.search.deployunitname},handleSizeChange:function(t){this.search.page=1,this.search.size=t,this.getapiList()},handleCurrentChange:function(t){this.search.page=t,this.getapiList()},getIndex:function(t){return(this.search.page-1)*this.search.size+t+1},showAddapiDialog:function(){this.dialogFormVisible=!0,this.dialogStatus="add",this.tmpapi.id="",this.tmpapi.deployunitid="",this.tmpapi.deployunitname="",this.tmpapi.apiname="",this.tmpapi.visittype="",this.tmpapi.apistyle="",this.tmpapi.path="",this.tmpapi.requestcontenttype="",this.tmpapi.responecontenttype="",this.tmpapi.memo="",this.tmpapi.creator=this.name},showCopyapiDialog:function(){this.CopydialogFormVisible=!0,this.tmpcopyapi.sourceapiid="",this.tmpcopyapi.sourceapiname="",this.tmpcopyapi.sourcedeployunitid="",this.tmpcopyapi.sourcedeployunitname="",this.tmpcopyapi.objectdeployunitid="",this.tmpcopyapi.objectdeployunitname="",this.tmpcopyapi.newapiname=""},addapi:function(){var t=this;this.$refs.tmpapi.validate(function(e){e&&(t.btnLoading=!0,t.tmpapi.path=t.tmpapi.path.trim(),Object(p.a)(t.tmpapi).then(function(){t.$message.success("添加成功"),t.getapiList(),t.dialogFormVisible=!1,t.btnLoading=!1}).catch(function(e){t.$message.error("添加失败"),t.btnLoading=!1}))})},showUpdateapiDialog:function(t){this.dialogFormVisible=!0,this.dialogStatus="update",this.tmpapi.id=this.apiList[t].id,this.tmpapi.deployunitid=this.apiList[t].deployunitid,this.tmpapi.deployunitname=this.apiList[t].deployunitname,this.tmpapi.apiname=this.apiList[t].apiname,this.tmpapi.visittype=this.apiList[t].visittype,this.tmpapi.path=this.apiList[t].path,this.tmpapi.apistyle=this.apiList[t].apistyle,this.tmpapi.responecontenttype=this.apiList[t].responecontenttype,this.tmpapi.memo=this.apiList[t].memo,this.tmpapi.creator=this.name,"get"===this.tmpapi.visittype?(this.requestcontenttypeVisible=!1,this.tmpapi.requestcontenttype=""):(this.tmpapi.requestcontenttype=this.apiList[t].requestcontenttype,this.requestcontenttypeVisible=!0)},updateapi:function(){var t=this;this.$refs.tmpapi.validate(function(e){e&&(t.tmpapi.path=t.tmpapi.path.trim(),Object(p.i)(t.tmpapi).then(function(){t.$message.success("更新成功"),t.getapiList(),t.dialogFormVisible=!1}).catch(function(e){t.$message.error("添加失败"),t.btnLoading=!1}))})},removeapi:function(t){var e=this;this.$confirm("删除该api？","警告",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(function(){var i=e.apiList[t].id;Object(p.g)(i).then(function(){e.$message.success("删除成功"),e.getapiList()})}).catch(function(){e.$message.info("已取消删除")})},isUniqueDetail:function(t){console.log(t.id);for(var e=0;e<this.apiList.length;e++)if(this.apiList[e].id!==t.id&&(console.log(this.apiList[e].id),this.apiList[e].apiname===t.apiname))return this.$message.error("api名已存在"),!1;return!0}}},u={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container"},[i("div",{staticClass:"filter-container"},[i("el-form",{attrs:{inline:!0}},[i("el-form-item",[t.hasPermission("api:list")?i("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-refresh"},nativeOn:{click:function(e){return e.preventDefault(),t.getapiList(e)}}},[t._v("刷新")]):t._e(),t._v(" "),t.hasPermission("api:add")?i("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus"},nativeOn:{click:function(e){return e.preventDefault(),t.showAddapiDialog(e)}}},[t._v("添加api")]):t._e(),t._v(" "),t.hasPermission("api:add")?i("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus"},nativeOn:{click:function(e){return e.preventDefault(),t.showCopyapiDialog(e)}}},[t._v("复制api")]):t._e()],1),t._v(" "),t.hasPermission("api:search")?i("span",[i("el-form-item",[i("el-input",{attrs:{placeholder:"api名"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchBy(e)}},model:{value:t.search.apiname,callback:function(e){t.$set(t.search,"apiname",e)},expression:"search.apiname"}})],1),t._v(" "),i("el-form-item",[i("el-input",{attrs:{placeholder:"发布单元名"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchBy(e)}},model:{value:t.search.deployunitname,callback:function(e){t.$set(t.search,"deployunitname",e)},expression:"search.deployunitname"}})],1),t._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary",loading:t.btnLoading},on:{click:t.searchBy}},[t._v("查询")])],1)],1):t._e()],1)],1),t._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading.body",value:t.listLoading,expression:"listLoading",modifiers:{body:!0}}],key:t.itemKey,attrs:{data:t.apiList,"element-loading-text":"loading",border:"",fit:"","highlight-current-row":""}},[i("el-table-column",{attrs:{label:"编号",align:"center",width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",{domProps:{textContent:t._s(t.getIndex(e.$index))}})]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"api名",align:"center",prop:"apiname",width:"120"}}),t._v(" "),i("el-table-column",{attrs:{label:"访问方式",align:"center",prop:"visittype",width:"80"}}),t._v(" "),i("el-table-column",{attrs:{label:"api风格",align:"center",prop:"apistyle",width:"80"}}),t._v(" "),i("el-table-column",{attrs:{label:"路径",align:"center",prop:"path",width:"100"}}),t._v(" "),i("el-table-column",{attrs:{label:"发布单元",align:"center",prop:"deployunitname",width:"130"}}),t._v(" "),i("el-table-column",{attrs:{label:"请求数据格式",align:"center",prop:"requestcontenttype",width:"100"}}),t._v(" "),i("el-table-column",{attrs:{label:"响应数据格式",align:"center",prop:"responecontenttype",width:"100"}}),t._v(" "),i("el-table-column",{attrs:{label:"操作人",align:"center",prop:"creator",width:"100"}}),t._v(" "),i("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"createTime",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.unix2CurrentTime(e.row.createTime)))]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"最后修改时间",align:"center",prop:"lastmodifyTime",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.unix2CurrentTime(e.row.lastmodifyTime))+"\n      ")]}}])}),t._v(" "),t.hasPermission("api:update")||t.hasPermission("api:delete")?i("el-table-column",{attrs:{label:"管理",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.hasPermission("api:update")&&e.row.id!==t.id?i("el-button",{attrs:{type:"warning",size:"mini"},nativeOn:{click:function(i){return i.preventDefault(),t.showUpdateapiDialog(e.$index)}}},[t._v("修改")]):t._e(),t._v(" "),t.hasPermission("api:delete")&&e.row.id!==t.id?i("el-button",{attrs:{type:"danger",size:"mini"},nativeOn:{click:function(i){return i.preventDefault(),t.removeapi(e.$index)}}},[t._v("删除")]):t._e()]}}],null,!1,139841798)}):t._e()],1),t._v(" "),i("el-pagination",{attrs:{"current-page":t.search.page,"page-size":t.search.size,total:t.total,"page-sizes":[10,20,30,40],layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}),t._v(" "),i("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[i("el-form",{ref:"tmpapi",staticClass:"small-space",staticStyle:{width:"350px","margin-left":"50px"},attrs:{"status-icon":"","label-position":"left","label-width":"120px",model:t.tmpapi}},[i("el-form-item",{attrs:{label:"api名",prop:"apiname",required:""}},[i("el-input",{attrs:{type:"text",maxlength:"40","prefix-icon":"el-icon-edit","auto-complete":"off"},model:{value:t.tmpapi.apiname,callback:function(e){t.$set(t.tmpapi,"apiname",e)},expression:"tmpapi.apiname"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"访问方式",prop:"visittype",required:""}},[i("el-select",{attrs:{placeholder:"访问方式"},on:{change:function(e){return t.visitypeselectChanged(e)}},model:{value:t.tmpapi.visittype,callback:function(e){t.$set(t.tmpapi,"visittype",e)},expression:"tmpapi.visittype"}},[i("el-option",{staticStyle:{display:"none"},attrs:{label:"请选择",value:"''"}}),t._v(" "),t._l(t.visittypeList,function(t,e){return i("div",{key:e},[i("el-option",{attrs:{label:t.dicitmevalue,value:t.dicitmevalue,required:""}})],1)})],2)],1),t._v(" "),i("el-form-item",{attrs:{label:"api风格",prop:"apistyle",required:""}},[i("el-select",{attrs:{placeholder:"api风格"},model:{value:t.tmpapi.apistyle,callback:function(e){t.$set(t.tmpapi,"apistyle",e)},expression:"tmpapi.apistyle"}},[i("el-option",{attrs:{label:"restful",value:"restful"}}),t._v(" "),i("el-option",{attrs:{label:"普通方式",value:"普通方式"}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"资源路径",prop:"path",required:""}},[i("el-input",{attrs:{type:"text",maxlength:"200","prefix-icon":"el-icon-message","auto-complete":"off"},model:{value:t.tmpapi.path,callback:function(e){t.$set(t.tmpapi,"path","string"==typeof e?e.trim():e)},expression:"tmpapi.path"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"发布单元",prop:"deployunitname",required:""}},[i("el-select",{attrs:{placeholder:"发布单元"},on:{change:function(e){return t.selectChanged(e)}},model:{value:t.tmpapi.deployunitname,callback:function(e){t.$set(t.tmpapi,"deployunitname",e)},expression:"tmpapi.deployunitname"}},[i("el-option",{staticStyle:{display:"none"},attrs:{label:"请选择",value:"''"}}),t._v(" "),t._l(t.deployunitList,function(t,e){return i("div",{key:e},[i("el-option",{attrs:{label:t.deployunitname,value:t.deployunitname,required:""}})],1)})],2)],1),t._v(" "),t.requestcontenttypeVisible?i("div",[i("el-form-item",{attrs:{label:"请求数据格式",prop:"requestcontenttype",required:""}},[i("el-select",{attrs:{placeholder:"请求数据格式"},model:{value:t.tmpapi.requestcontenttype,callback:function(e){t.$set(t.tmpapi,"requestcontenttype",e)},expression:"tmpapi.requestcontenttype"}},[i("el-option",{staticStyle:{display:"none"},attrs:{label:"请选择",value:"''"}}),t._v(" "),t._l(t.requestcontentList,function(t,e){return i("div",{key:e},[i("el-option",{attrs:{label:t.dicitmevalue,value:t.dicitmevalue,required:""}})],1)})],2)],1)],1):t._e(),t._v(" "),i("el-form-item",{attrs:{label:"响应数据格式",prop:"responecontenttype",required:""}},[i("el-select",{attrs:{placeholder:"响应数据格式"},model:{value:t.tmpapi.responecontenttype,callback:function(e){t.$set(t.tmpapi,"responecontenttype",e)},expression:"tmpapi.responecontenttype"}},[i("el-option",{staticStyle:{display:"none"},attrs:{label:"请选择",value:"''"}}),t._v(" "),t._l(t.responecontenttypeList,function(t,e){return i("div",{key:e},[i("el-option",{attrs:{label:t.dicitmevalue,value:t.dicitmevalue,required:""}})],1)})],2)],1),t._v(" "),i("el-form-item",{attrs:{label:"备注",prop:"memo"}},[i("el-input",{attrs:{type:"text",maxlength:"100","prefix-icon":"el-icon-message","auto-complete":"off"},model:{value:t.tmpapi.memo,callback:function(e){t.$set(t.tmpapi,"memo",e)},expression:"tmpapi.memo"}})],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{nativeOn:{click:function(e){e.preventDefault(),t.dialogFormVisible=!1}}},[t._v("取消")]),t._v(" "),"add"===t.dialogStatus?i("el-button",{attrs:{type:"danger"},nativeOn:{click:function(e){return e.preventDefault(),t.$refs.tmpapi.resetFields()}}},[t._v("重置")]):t._e(),t._v(" "),"add"===t.dialogStatus?i("el-button",{attrs:{type:"success",loading:t.btnLoading},nativeOn:{click:function(e){return e.preventDefault(),t.addapi(e)}}},[t._v("添加")]):t._e(),t._v(" "),"update"===t.dialogStatus?i("el-button",{attrs:{type:"success",loading:t.btnLoading},nativeOn:{click:function(e){return e.preventDefault(),t.updateapi(e)}}},[t._v("修改")]):t._e()],1)],1),t._v(" "),i("el-dialog",{attrs:{title:t.CopyApi,visible:t.CopydialogFormVisible},on:{"update:visible":function(e){t.CopydialogFormVisible=e}}},[i("el-form",{ref:"tmpcopyapi",staticClass:"small-space",staticStyle:{width:"350px","margin-left":"50px"},attrs:{"status-icon":"","label-position":"left","label-width":"120px",model:t.tmpcopyapi}},[i("el-form-item",{attrs:{label:"源发布单元",prop:"sourcedeployunitname",required:""}},[i("el-select",{attrs:{placeholder:"发布单元"},on:{change:function(e){return t.CopyAPISourceDeployselectChanged(e)}},model:{value:t.tmpcopyapi.sourcedeployunitname,callback:function(e){t.$set(t.tmpcopyapi,"sourcedeployunitname",e)},expression:"tmpcopyapi.sourcedeployunitname"}},[i("el-option",{staticStyle:{display:"none"},attrs:{label:"请选择",value:"''"}}),t._v(" "),t._l(t.deployunitList,function(t,e){return i("div",{key:e},[i("el-option",{attrs:{label:t.deployunitname,value:t.deployunitname,required:""}})],1)})],2)],1),t._v(" "),i("el-form-item",{attrs:{label:"API来源名",prop:"sourceapiname",required:""}},[i("el-select",{attrs:{placeholder:"api"},on:{change:function(e){return t.CopySourceAPIChanged(e)}},model:{value:t.tmpcopyapi.sourceapiname,callback:function(e){t.$set(t.tmpcopyapi,"sourceapiname",e)},expression:"tmpcopyapi.sourceapiname"}},[i("el-option",{staticStyle:{display:"none"},attrs:{label:"请选择",value:"''"}}),t._v(" "),t._l(t.sourceapiList,function(t,e){return i("div",{key:e},[i("el-option",{attrs:{label:t.apiname,value:t.apiname,required:""}})],1)})],2)],1),t._v(" "),i("el-form-item",{attrs:{label:"目标发布单元",prop:"objectdeployunitname",required:""}},[i("el-select",{attrs:{placeholder:"发布单元"},on:{change:function(e){return t.CopyObjectAPIDeployUnitChanged(e)}},model:{value:t.tmpcopyapi.objectdeployunitname,callback:function(e){t.$set(t.tmpcopyapi,"objectdeployunitname",e)},expression:"tmpcopyapi.objectdeployunitname"}},[i("el-option",{staticStyle:{display:"none"},attrs:{label:"请选择",value:"''"}}),t._v(" "),t._l(t.deployunitList,function(t,e){return i("div",{key:e},[i("el-option",{attrs:{label:t.deployunitname,value:t.deployunitname,required:""}})],1)})],2)],1),t._v(" "),i("el-form-item",{attrs:{label:"目标API名",prop:"newapiname",required:""}},[i("el-input",{attrs:{type:"text",maxlength:"40","prefix-icon":"el-icon-edit","auto-complete":"off"},model:{value:t.tmpcopyapi.newapiname,callback:function(e){t.$set(t.tmpcopyapi,"newapiname",e)},expression:"tmpcopyapi.newapiname"}})],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{nativeOn:{click:function(e){e.preventDefault(),t.CopydialogFormVisible=!1}}},[t._v("取消")]),t._v(" "),i("el-button",{attrs:{type:"success",loading:t.btnLoading},nativeOn:{click:function(e){return e.preventDefault(),t.copyapi(e)}}},[t._v("保存\n      ")])],1)],1)],1)},staticRenderFns:[]},d=i("VU/8")(c,u,!1,null,null,null);e.default=d.exports}});
//# sourceMappingURL=40.0244c68445301a182d75.js.map